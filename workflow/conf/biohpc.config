params {
  refSource = "biohpc"
}

process {
  executor = 'slurm'
  queue = 'super'
  clusterOptions = '--hold'

  withName:trackStart {
    executor = 'local'
  }
  withName:getBag {
    executor = 'local'
    errorStrategy = 'retry'
    maxRetries = 1
  }
  withName:getData {
    queue = 'super'
    errorStrategy = 'retry'
    maxRetries = 1
  }
  withName:parseMetadata {
    executor = 'local'
  }
  withName:trimData {
    queue = 'super'
    errorStrategy = 'retry'
    maxRetries = 1
  }
  withName:getRefInfer {
    queue = 'super'
  }
  withName:downsampleData {
    executor = 'local'
  }
  withName:alignSampleData {
    queue = 'super'
  }
  withName:inferMetadata {
    queue = 'super'
  }
  withName:checkMetadata {
    executor = 'local'
  }
  withName:getRef {
    queue = 'super'
  }
  withName:alignData {
    queue = '256GB,256GBv1'
  }
  withName:dedupData {
    queue = 'super'
  }
  withName:countData {
    queue = 'super'
  }
  withName:makeBigWig {
    queue = 'super'
  }
  withName:fastqc {
    queue = 'super'
  }
  withName:dataQC {
    queue = 'super'
  }
  withName:aggrQC {
    executor = 'local'
  }
  withName:uploadInputBag {
    executor = 'local'
    errorStrategy = 'retry'
    maxRetries = 1
  }
  withName:uploadExecutionRun {
    executor = 'local'
    errorStrategy = 'retry'
    maxRetries = 1
  }
  withName:uploadQC {
    executor = 'local'
  }
  withName:uploadProcessedFile {
    executor = 'local'
    errorStrategy = 'retry'
    maxRetries = 1
  }
  withName:uploadOutputBag {
    executor = 'local'
  }
  withName:finalizeExecutionRun {
    executor = 'local'
    errorStrategy = 'retry'
    maxRetries = 1
  }
  withName:failPreExecutionRun {
    executor = 'local'
    errorStrategy = 'retry'
    maxRetries = 1
  }
  withName:failPreExecutionRun {
    executor = 'local'
    errorStrategy = 'retry'
    maxRetries = 1
  }
  withName:failExecutionRun {
    executor = 'local'
    errorStrategy = 'retry'
    maxRetries = 1
  }
}

singularity {
  enabled = true
  cacheDir = '/project/BICF/BICF_Core/shared/gudmap/singularity_cache/'
}

env {
  http_proxy = 'http://proxy.swmed.edu:3128'
  https_proxy = 'http://proxy.swmed.edu:3128'
  all_proxy = 'http://proxy.swmed.edu:3128'
}
